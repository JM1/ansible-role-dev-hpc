---
- set_fact:
    apt_packages: "{{ __apt_packages|list }}"
  when: apt_packages|default(None) == None

- name: Cleanup role default variables
  set_fact:
    __apt_packages: !!null

- copy:
    src: "{{ ansible_distribution }}-{{ ansible_distribution_version }}/"
    dest: /
    mode: preserve

- include_role:
    name: jm1.virtual_pkg
  vars:
     package_name: "jm1-dev-hpc"
     package_depends: "{{ apt_packages }}"

- shell: "/usr/local/bin/make_install_{{ item|lower }}.sh"
  register: install_result
  changed_when:
    not (install_result.rc == 124 and install_result.stderr == "{{ item }} is already installed. Skipping..")
  failed_when: not (
        (install_result.rc == 0) or
        (install_result.rc == 124 and install_result.stderr == "{{ item }} is already installed. Skipping..")
    )
  loop:
  - FLAME
  - Elemental
  - fmt

- set_fact:
    apt_packages: !!null
    install_result: !!null
